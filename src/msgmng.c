/******************************************************************************/
/*                                                                            */
/*            H A N D L E   M Q   B A C K O U T   M E S S A G E S             */
/*                                                      */
/*                    M E S S A G E   M A N A G E M E N T                     */
/*                                              */
/*                              M S G M N G . C                               */
/*                                                                            */
/* -------------------------------------------------------------------------- */
/*                                                                            */
/*    - initMsgList                        */
/*    - initMsgId                        */
/*                                          */
/******************************************************************************/

/******************************************************************************/

/******************************************************************************/
/*   I N C L U D E S                                                          */
/******************************************************************************/

// ---------------------------------------------------------
// system
// ---------------------------------------------------------
#include <errno.h>
#include <time.h>
#include <stdlib.h>
#include <string.h>

// ---------------------------------------------------------
// MQ
// ---------------------------------------------------------
#include <cmqc.h>

// ---------------------------------------------------------
// own 
// ---------------------------------------------------------
#include "ctl.h"
#include "msgcat/lgstd.h"

/******************************************************************************/
/*   T Y P E S                                                                */
/******************************************************************************/
typedef struct sMsgId tMsgId ;

/******************************************************************************/
/*   S T R U C T S                                                            */
/******************************************************************************/
struct sMsgId
{
  MQBYTE24 msgId ;
  time_t   ts    ;
};

/******************************************************************************/
/*   D E F I N E S                                                            */
/******************************************************************************/
#define MAX_MSG_ID_LIST_LNG 1024

/******************************************************************************/
/*   M A C R O S                                                              */
/******************************************************************************/

/******************************************************************************/
/*   G L O B A L S                                                            */
/******************************************************************************/
tMsgId **_gMsgIdList = NULL ;

/******************************************************************************/
/*   P R O T O T Y P E S                                                      */
/******************************************************************************/
tMsgId* initMsgId();

/******************************************************************************/
/*                                                                            */
/*   F U N C T I O N S                                                        */
/*                                                                            */
/******************************************************************************/

/******************************************************************************/
/*   initialize  message id list            */
/******************************************************************************/
int initMsgIdList()
{
  logFuncCall() ;               

  int sysRc = 0 ;

  int i;

  _gMsgIdList = (tMsgId**) malloc( MAX_MSG_ID_LIST_LNG *sizeof(tMsgId*));
  if( !_gMsgIdList )
  {
    logger( LSTD_MEM_ALLOC_ERROR );       //
    sysRc = errno ;                       //
    goto _door;                           //
  }

  for( i=0; i<MAX_MSG_ID_LIST_LNG; i++ )
  {
    _gMsgIdList[i] = initMsgId();
    if( !_gMsgIdList[i] )
    {
      sysRc =errno ;
      goto _door;
    }
  }

  _door :

  logFuncExit( );
  return sysRc ;
}

/******************************************************************************/
/*   initialize  message id node      */
/******************************************************************************/
tMsgId* initMsgId()
{
  logFuncCall() ;               

  tMsgId* node = NULL ;

  node = (tMsgId*) malloc( sizeof(tMsgId) );

  if( !node )
  {
    logger( LSTD_MEM_ALLOC_ERROR );       //
    goto _door;                           //
  }

  memcpy( node->msgId, MQMI_NONE, sizeof(MQBYTE24) );             
  node->ts = 0 ;

  _door :

  logFuncExit( );
  return node ;
}

